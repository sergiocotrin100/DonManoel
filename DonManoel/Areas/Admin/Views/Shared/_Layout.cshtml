@inject Core.Interfaces.IUserSession usuario;
@using CrossCutting;

<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Language" content="pt-br">
    <meta name="mobile-web-app-capable" content="yes">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="O melhor restaurnte de campinas e região">
    <meta name="author" content="demissmartin@hotmail.com;sergiocotrim100@yahoo.com">
    <meta name="HandheldFriendly" content="True">
    <meta http-equiv="cleartype" content="on">
    <meta name="browser-support" content="samesite=true">
    <link rel="icon" href="~/admin/images/favicon_Don_Manoel.png">

    <title>Don Manoel</title>

    <!-- Vendors Style-->
    <link rel="stylesheet" href="~/admin/css/vendors_css.css">

    <!-- Style-->
    <link rel="stylesheet" href="~/admin/css/horizontal-menu.css">
    <link rel="stylesheet" href="~/admin/css/style.css">
    <link rel="stylesheet" href="~/admin/css/skin_color.css">
    <link rel="manifest" href="/manifest.webmanifest" />
    <meta name="theme-color" content="#2196f3" />
</head>

<body class="layout-top-nav light-skin theme-primary fixed">

    @{
        var GraficoPedidosSemanal = (List<Core.Entities.GraphOrders>)ViewBag.GraficoPedidosSemanal;
        var lstGraficoPedidosSemanal = Newtonsoft.Json.JsonConvert.SerializeObject(GraficoPedidosSemanal);

        var GraficoPedidosSemanalGarcom = (List<Core.Entities.GraphOrders>)ViewBag.GraficoPedidosSemanalGarcom;
        var lstGraficoPedidosSemanalGarcom = Newtonsoft.Json.JsonConvert.SerializeObject(GraficoPedidosSemanalGarcom);
    }


    <script type="text/javascript">
        var GRAFICOPEDIDOSSEMANAL = JSON.parse('@Html.Raw(lstGraficoPedidosSemanal)');
        var GRAFICOPEDIDOSSEMANALGARCOM  = JSON.parse('@Html.Raw(lstGraficoPedidosSemanalGarcom)');
    </script>


    @if (usuario.IsAuthenticated())
    {
        <div class="wrapper">
            <div id="loader"></div>

            <header class="main-header">
                <div class="inside-header">
                    @if (usuario.Role != Settings.Role.Cozinha)
                    {
                        <div class="d-none d-sm-block d-flex align-items-center logo-box justify-content-start">
                            <a asp-area="Admin" asp-controller="Home" asp-action="Index" class="logo">
                                <div class="logo-lg">
                                    <span class="light-logo"><img src="~/admin/images/logo don manoel 160 x 55.png" alt="logo"></span>
                                    <span class="dark-logo"><img src="~/admin/images/logo don manoel 160 x 55.png" alt="logo"></span>
                                </div>
                            </a>
                        </div>
                    }
                    else
                    {
                        <div class="d-none d-sm-block d-flex align-items-center logo-box justify-content-start">
                            <a asp-area="Admin" asp-controller="Sales" asp-action="kitchen" class="logo">
                                <div class="logo-lg">
                                    <span class="light-logo"><img src="~/admin/images/logo don manoel 160 x 55.png" alt="logo"></span>
                                    <span class="dark-logo"><img src="~/admin/images/logo don manoel 160 x 55.png" alt="logo"></span>
                                </div>
                            </a>
                        </div>
                    }
                    <!-- Header Navbar -->
                    <nav class="navbar navbar-static-top">
                        <!-- Sidebar toggle button-->
                        @*campo de busca no topo do site*@
                        <div class="app-menu">
                            <ul class="header-megamenu nav">
                                <li class="btn-group nav-item d-none d-xl-inline-block">
                                    <div class="app-menu">
                                        <div class="search-bx mx-5">
                                            @*<form>
                                                    <div class="input-group">
                                                        <input type="search" class="form-control" placeholder="Search" aria-label="Search" aria-describedby="button-addon2">
                                                        <div class="input-group-append">
                                                            <button class="btn" type="submit" id="button-addon3"><i class="ti-search"></i></button>
                                                        </div>
                                                    </div>
                                                </form>*@
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>

                        <div class="navbar-custom-menu r-side">
                            <ul class="nav navbar-nav">
                                @if (usuario.Role != Settings.Role.Cozinha)
                                {
                                    <li class="btn-group nav-item d-lg-inline-flex ">
                                        <a asp-area="Admin" asp-controller="Home" asp-action="Index" class="waves-effect waves-light nav-link full-screen btn-info-light" title="Home">
                                            <i class="icon-Home"><span class="path1"></span><span class="path2"></span></i>
                                        </a>
                                    </li>
                                    <li class="dropdown notifications-menu">
                                        @{
                                            var lstPedidos = (List<Core.Entities.Pedido>)ViewBag.MeusPedidos;
                                        }
                                        <span class="label label-primary">@lstPedidos.Count</span>
                                        <a href="#" class="waves-effect waves-light dropdown-toggle btn-danger-light" data-bs-toggle="dropdown" title="Meus Pedidos">
                                            <i class="icon-Dinner"><span class="path1"></span><span class="path2"></span></i>
                                        </a>
                                        <ul class="dropdown-menu animated bounceIn">

                                            <li class="header">
                                                <div class="p-20">
                                                    <div class="flexbox">
                                                        <div>
                                                            <h4 class="mb-0 mt-0">Meus Pedidos</h4>
                                                        </div>
                                                    </div>
                                                </div>
                                            </li>
                                            <li>
                                                <ul class="menu sm-scrol">
                                                    @foreach (var pedido in lstPedidos)
                                                    {
                                                        <li>
                                                            <a href="/Admin/Sales/Order?idmesa=@pedido.IdMesa&idorder=@pedido.Id&viewitens=1">
                                                                <i class="fa fa-users text-info"></i> Mesa: @pedido.IdMesa.ToString("000") - Pedido: @pedido.Id.ToString("0000") <br />
                                                                <span style="font-size:12px; float:right;" class="text-danger">@pedido.Status</span>
                                                            </a>
                                                        </li>
                                                    }
                                                </ul>
                                            </li>
                                        </ul>
                                    </li>
                                }
                                <li class="btn-group nav-item d-lg-inline-flex d-none">
                                    <a href="#" data-provide="fullscreen" class="waves-effect waves-light nav-link full-screen btn-info-light" title="Full Screen">
                                        <i class="icon-Expand-arrows"><span class="path1"></span><span class="path2"></span></i>
                                    </a>
                                </li>
                                <!-- Notifications -->
                                <li class="dropdown notifications-menu">
                                    <span class="label label-primary">5</span>
                                    <a href="#" class="waves-effect waves-light dropdown-toggle btn-primary-light" data-bs-toggle="dropdown" title="Notifications">
                                        <i class="icon-Notifications"><span class="path1"></span><span class="path2"></span></i>
                                    </a>
                                    <ul class="dropdown-menu animated bounceIn">

                                        <li class="header">
                                            <div class="p-20">
                                                <div class="flexbox">
                                                    <div>
                                                        <h4 class="mb-0 mt-0">Notificações</h4>
                                                    </div>
                                                    <div>
                                                        <a href="#" class="text-danger">Limpar todas</a>
                                                    </div>
                                                </div>
                                            </div>
                                        </li>

                                        <li>
                                            <!-- inner menu: contains the actual data -->
                                            <ul class="menu sm-scrol">
                                                <li>
                                                    <a href="#">
                                                        <i class="fa fa-users text-info"></i> Atenção: Hoje premio para 10 vinhos vendidos!
                                                    </a>
                                                </li>
                                                <li>
                                                    <a href="#">
                                                        <i class="fa fa-users text-info"></i> Mesa 10 necessita de mais pratos.
                                                    </a>
                                                </li>
                                                <li>
                                                    <a href="#">
                                                        <i class="fa fa-warning text-warning"></i> Mesa 1 está com pressa.
                                                    </a>
                                                </li>

                                                <li>
                                                    <a href="#">
                                                        <i class="fa fa-user text-danger"></i> Vinhos "Don Manuel" em promoção.
                                                    </a>
                                                </li>
                                            </ul>
                                        </li>
                                        <li class="footer">
                                            <a href="#">Ver todas...</a>
                                        </li>
                                    </ul>
                                </li>
                                <li class="btn-group nav-item">
                                    <a href="#" class="push-btn right-bar-btn waves-effect waves-light nav-link full-screen btn-info-light">
                                        <span class="icon-Layout-left-panel-1"><span class="path1"></span><span class="path2"></span></span>
                                    </a>
                                </li>
                                <!-- User Account-->
                                <li class="dropdown user user-menu">
                                    <a href="#" class="dropdown-toggle p-0 text-dark hover-primary ms-md-30 ms-10" data-bs-toggle="dropdown" title="User">
                                        <span class="ps-30 d-md-inline-block d-none">Olá,</span> <strong class="d-md-inline-block d-none">@usuario.Name.FirstName()</strong><img src="~/admin/images/avatar/avatar-11.png" class="user-image rounded-circle avatar bg-white mx-10" alt="User Image">
                                    </a>
                                    <ul class="dropdown-menu animated flipInX">
                                        <li class="user-body">
                                            @*<a class="dropdown-item" href="#"><i class="ti-user text-muted me-2"></i> Perfil</a>
                                                <a class="dropdown-item" href="#"><i class="ti-wallet text-muted me-2"></i> Atendimentos</a>
                                                <a class="dropdown-item" href="#"><i class="ti-settings text-muted me-2"></i> Configurações</a>*@
                                            <div class="dropdown-divider"></div>
                                            <a class="dropdown-item" asp-area="Admin" asp-controller="AccessUser" asp-action="LogoutAsync"><i class="ti-lock text-muted me-2"></i> Sair</a>
                                        </li>
                                    </ul>
                                </li>

                            </ul>
                        </div>
                    </nav>
                </div>
            </header>

            <nav class="main-nav" role="navigation">

                <!-- Mobile menu toggle button (hamburger/x icon) -->
                <input id="main-menu-state" type="checkbox" />
                <label class="main-menu-btn" for="main-menu-state">
                    <span class="main-menu-btn-icon"></span> Toggle main menu visibility
                </label>

                <!-- Sample menu definition -->
                <ul id="main-menu" class="sm sm-blue">
                    @if (usuario.Role != Settings.Role.Cozinha)
                    {
                        <li>
                            <a asp-area="Admin" asp-controller="Home" asp-action="Index"><i class="icon-Home"></i>Início</a>
                        </li>
                    }
                    <li>
                        <a href="#"><i class="icon-Clipboard-check"><span class="path1"></span><span class="path2"></span><span class="path3"></span></i>Pedidos</a>
                        <ul>
                            <li><a asp-area="Admin" asp-controller="Sales" asp-action="kitchen"><i class="icon-Commit"><span class="path1"></span><span class="path2"></span></i>Cozinha</a></li>
                            <li><a asp-area="Admin" asp-controller="Sales" asp-action="Bar"><i class="icon-Commit"><span class="path1"></span><span class="path2"></span></i>Bar</a></li>
                            <li><a asp-area="Admin" asp-controller="Sales" asp-action="Index"><i class="icon-Commit"><span class="path1"></span><span class="path2"></span></i>Pedidos</a></li>
                            <li><a href="#" data-bs-toggle="modal" data-bs-target="#modalPedidosImpressao"><i class="icon-Commit"><span class="path1"></span><span class="path2"></span></i>Impressão</a></li>
                        </ul>
                    </li>
                    @*<li>
                            <a href="#"><i class="icon-Dinner"><span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span><span class="path5"></span></i>Menus</a>
                            <ul>
                                <li><a href="add_new_menu.html"><i class="icon-Commit"><span class="path1"></span><span class="path2"></span></i>Pratos</a></li>
                                <li><a href="menu_categories.html"><i class="icon-Commit"><span class="path1"></span><span class="path2"></span></i>Bebidas</a></li>
                            </ul>
                        </li>*@
                </ul>
            </nav>

            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper">
                <div class="container-full">
                    <!-- Main content -->
                    @RenderBody()
                    <!-- /.content -->
                </div>
            </div>
            <!-- /.content-wrapper -->
            <!-- Content Right Sidebar -->
            <div class="right-bar">
                <div id="sidebarRight">
                    <div class="right-bar-inner">
                        <div class="text-end position-relative">
                            <a href="#" class="btn right-bar-btn waves-effect waves-circle btn btn-circle btn-danger btn-sm">
                                <i class="mdi mdi-close"></i>
                            </a>
                        </div>
                        <div class="right-bar-content">
                            <div class="box no-shadow box-bordered border-light">
                                <div class="box-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h5>Meus Pedidos</h5>
                                            <h2 class="mb-0 text-center">@ViewBag.GraficoQuantidadePedidos</h2>
                                        </div>
                                        <div class="p-10">
                                            <div id="chart-pedidos"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            @if (usuario.Role == CrossCutting.Settings.Role.Caixa || usuario.Role == CrossCutting.Settings.Role.Gerente)
                            {
                                <div class="box no-shadow box-bordered border-light">
                                    <div class="box-body">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <h5>Pedidos/Garçom</h5>
                                                <h2 class="mb-0 text-center">@ViewBag.GraficoQuantidadePedidosGarcom</h2>
                                            </div>
                                            <div class="p-10">
                                                <div id="chart-pedidos-garcon"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }

                            @*<div class="box no-shadow box-bordered border-light">
                                    <div class="box-body">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <h5>Item/Dia</h5>
                                                <h2 class="mb-0">5.12%</h2>
                                            </div>
                                            <div class="p-10">
                                                <div id="chartItemSemanal"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="box-footer">
                                        <div class="d-flex align-items-center justify-content-between">
                                            <h5 class="my-0"><span class="badge badge-xl badge-dot badge-primary me-10"></span>Reclamação</h5>
                                            <h5 class="my-0"><span class="badge badge-xl badge-dot badge-danger me-10"></span>Elogio</h5>
                                        </div>
                                    </div>
                                </div>*@
                            <div class="box no-shadow box-bordered border-light">
                                <div class="box-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h5>Vinhos Vendidos</h5>
                                            <h2 class="mb-0">R$254.90</h2>
                                        </div>
                                        <div class="p-10">
                                            <div id="chart-spark1"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="box-footer">
                                    <div class="d-flex align-items-center justify-content-between">
                                        <h5 class="my-0">6 mesas atendidas</h5>
                                        <a href="#" class="mb-0">Ver relatório</a>
                                    </div>
                                </div>
                            </div>
                            <div class="box no-shadow box-bordered border-light">
                                <div class="box-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h5>Total Semanal</h5>
                                            <h2 class="mb-0">845.99</h2>
                                        </div>
                                        <div class="p-10">
                                            <div id="chart-spark2"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="box-footer">
                                    <div class="d-flex align-items-center justify-content-between">
                                        <a href="#" class="btn btn-primary-light btn-sm">Vinhos</a>
                                        <a href="#" class="btn btn-info-light btn-sm">280 Mesas</a>
                                        <a href="#" class="btn btn-success-light btn-sm">Metas</a>
                                    </div>
                                </div>
                            </div>
                            <div class="box no-shadow box-bordered border-light">
                                <div class="box-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h5>Reclamações e Elogios</h5>
                                            <h2 class="mb-0">5.12%</h2>
                                        </div>
                                        <div class="p-10">
                                            <div id="chart3"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="box-footer">
                                    <div class="d-flex align-items-center justify-content-between">
                                        <h5 class="my-0"><span class="badge badge-xl badge-dot badge-primary me-10"></span>Reclamação</h5>
                                        <h5 class="my-0"><span class="badge badge-xl badge-dot badge-danger me-10"></span>Elogio</h5>
                                    </div>
                                </div>
                            </div>
                            <div class="box no-shadow box-bordered border-light">
                                <div class="box-header">
                                    <h4 class="box-title">Atividade Recente</h4>
                                </div>
                                <div class="box-body p-5">
                                    <div class="media-list media-list-hover">
                                        <a class="media media-single mb-10 p-0 rounded-0" href="#">
                                            <h4 class="w-50 text-gray fw-500">10:10</h4>
                                            <div class="media-body ps-15 bs-5 rounded border-primary">
                                                <p>Entrada No Trabalho.</p>
                                                <span class="text-fade">hora login</span>
                                            </div>
                                        </a>




                                        <a class="media media-single mb-10 p-0 rounded-0" href="#">
                                            <h4 class="w-50 text-gray fw-500">23:23</h4>
                                            <div class="media-body ps-15 bs-5 rounded border-danger">
                                                <p>Fim do Expediente</p>
                                                <span class="text-fade">hora login</span>
                                            </div>
                                        </a>



                                    </div>
                                </div>
                                <div class="box-footer">
                                    <div class="text-center">
                                        <a href="#" class="mb-0">Ver tudo...</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /.Content Right Sidebar -->

            <footer class="main-footer">
                <div class="pull-right d-none d-sm-inline-block">
                    <ul class="nav nav-primary nav-dotted nav-dot-separated justify-content-center justify-content-md-end">
                        <li class="nav-item">
                            <a class="nav-link" href="javascript:void(0)">FAQ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="mailto:ti11@furacao.com.br?cc=ti08@furacao.com.br&subject=Contato%20Don%20Manoel&body=Dúvida:">Dúvidas</a>
                        </li>
                    </ul>
                </div>
                &copy; 2021 <a href="#">FW Distribuidora</a>. Todos os direitos reservados.
            </footer>

            <div class="control-sidebar-bg"></div>

        </div>
    }
    else
    {
        @RenderBody()
    }

    <!-- Modal -->

    <div class="modal fade" data-backdrop="false" id="modalPedidosImpressao" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Pedidos</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    @{
                        var resultMesas = (List<Core.Entities.Mesa>)ViewBag.PedidosImpressao;
                        var mesas = Newtonsoft.Json.JsonConvert.SerializeObject(resultMesas);
                    }


                    <script type="text/javascript">
                        var LISTAPEDIDOSIMPRESSAO = JSON.parse('@Html.Raw(mesas)');
                    </script>

                    @foreach (var mesa in (List<Core.Entities.Mesa>)ViewBag.PedidosImpressao)
                    {
                        <div class="box box-solid bg-secondary">
                            <div class="box-header">
                                <div class="row">
                                    <div class="col-sm-12 col-md-12 col-lg-12">
                                        <div class="col-sm-6 col-md-6 col-lg-12">
                                            <h4 class="box-title" style="float:left">
                                                <a href="/Sales/Order?idmesa=@mesa.Id&idorder=@mesa.IdPedido"> <strong>Mesa <b>@mesa.Numero.ToString("000")</b></strong></a>
                                            </h4>
                                        </div>
                                        <div class="col-sm-6 col-md-6 col-lg-12">
                                            <div class="text-end flex-grow">
                                                <button class="btn btn-sm btn-danger" onclick="printOrderPreparacaoById(@mesa.IdPedido)"><i class="fa fa-print"></i> Imprimir</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="box-body">
                                <a href="/Sales/Order?idmesa=@mesa.Id&idorder=@mesa.IdPedido">
                                    <div class="row">
                                        <div class="col-12 col-sm-12 col-md-12 col-lg-12" style="display: inline-flex;">
                                            <div class="col-4 col-sm-4 col-md-4 col-lg-4" style="padding: 0px 15px 0px 0px;">
                                                <i class="icon-Calculator"></i> Sub-total <br />
                                                <b>@mesa.Pedido.ValorItens.FormatMoney(false)</b>
                                            </div>
                                            <div class="col-4 col-sm-4 col-md-4 col-lg-4" style="padding: 0px 15px 0px 0px;">
                                                <i class="icon-Calculator"></i> Total <br />
                                                <b>@mesa.Pedido.ValorTotalPedido.FormatMoney(false)</b>
                                            </div>
                                            <div class="col-4 col-sm-4 col-md-4 col-lg-4">
                                                <i class="icon-User"></i> Atendente <br />
                                                @mesa.Atendente.FirstName()
                                            </div>
                                        </div>
                                    </div>
                                    <ul class="list-group list-group-flush" style="float:right;">
                                        <li class="list-group-item">
                                            <i class="icon-Clock"></i> Tempo de uso da mesa:
                                            @mesa.Tempo
                                        </li>
                                    </ul>
                                </a>
                            </div>

                        </div>
                    }
                </div>
                <div class="modal-footer">
                    <div class="d-grid gap-2 d-flex">
                        <button type="button" class="btn btn-default" data-bs-dismiss="modal" style="float:left;">Fechar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal modal-fill fade" data-backdrop="false" id="modalImpressao" tabindex="-1" style="width:288px !important;">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Impressão</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <br />
                    <div id="divImpressao" style="background-color: #FFFF66;width:258px;">

                        <p>
                            <br />
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dom Manoel Restaurante Ltda.<br />
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Telefone: 19 98374-6228<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; SEM VALOR FISCAL<br>
                            ----------------------------------------------<br>
                            &nbsp;&nbsp;&nbsp; Data: <span id="datapedidoimpressao"></span>&nbsp; Hora: <span id="horapedidoimpressao"></span> <br />
                            &nbsp;&nbsp;&nbsp; Nº VENDA <span id="numeropedidoimpressao" style="font-weight: bold;"></span> MESA: <span id="numeromesaimpressao" style="font-weight: bold;"></span><br />
                            ----------------------------------------------<br />
                            <table id="tableItensImpressao">
                                <thead>
                                    <tr>
                                        <th>Qtde</th>
                                        <th>Descrição</th>
                                        <th style="text-align: right;">Unit.</th>
                                        <th style="text-align: right;">Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td colspan="4">
                                            <hr />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="2" style="text-align:left;">
                                            Sub-Total
                                        </td>
                                        <td colspan="2" style="text-align: right;font-weight: bold;">
                                            <span id="subtotalimpressao"></span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="2" style="text-align:left;">
                                            Taxa de Serviço
                                        </td>
                                        <td colspan="2" style="text-align: right;font-weight: bold;">
                                            <span id="taxaservicoimpressao"></span>
                                        </td>
                                    </tr>

                                    <tr>
                                        <td colspan="2" style="text-align: left;font-size:18px;">
                                            Valor Total
                                        </td>
                                        <td colspan="2" style="text-align: right;font-weight: bold;font-size: 18px;">
                                            <span id="subtotalimpressao"></span>
                                        </td>
                                    </tr>
                                </tfoot>
                            </table>

                        </p>
                        <p>
                            ----------------------------------------------<br />
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; OBRIGADO PELA PREFERÊNCIA<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; VOLTE SEMPRE
                        </p>
                        <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; ----------------------------&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
                        <p>&nbsp;</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="d-grid gap-2 d-flex">
                        <button type="button" class="btn btn-default" data-bs-dismiss="modal" style="float:left;">Fechar</button>
                        <button type="button" class="btn btn-danger float-end" onclick="imprimirContaMesa();" style="float:right;">
                            <i class="fa fa-print"></i> Imprimir
                        </button>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <div class="modal modal-fill fade" data-backdrop="false" id="modalImpressaoPreparacao" tabindex="-1" style="width:288px !important;">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Impressão</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="divImpressaoPreparacao" style="background-color: #FFFF66;width:258px;">
                        <p>
                            <br />
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dom Manoel Restaurante Ltda.<br />
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Telefone: 19 98374-6228<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; SEM VALOR FISCAL<br>
                            ----------------------------------------------<br>
                            &nbsp;&nbsp;&nbsp; Data: <span id="datapedidoimpressao"></span>&nbsp; Hora: <span id="horapedidoimpressao"></span> <br />
                            &nbsp;&nbsp;&nbsp; Nº VENDA <span id="numeropedidoimpressao" style="font-weight: bold;"></span> MESA: <span id="numeromesaimpressao" style="font-weight: bold;"></span><br />
                            ----------------------------------------------<br />
                            <table id="tableItensImpressaoPreparacao">
                                <thead>
                                    <tr>
                                        <th>Item</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>

                        </p>
                        <p>
                            ----------------------------------------------<br />
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; OBRIGADO PELA PREFERÊNCIA<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; VOLTE SEMPRE
                        </p>
                        <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; ----------------------------&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
                        <p>&nbsp;</p>


                    </div>
                </div>
                <div class="modal-footer">
                    <div class="d-grid gap-2 d-flex">
                        <button type="button" class="btn btn-default" data-bs-dismiss="modal" style="float:left;">Fechar</button>
                        <button type="button" class="btn btn-danger float-end" onclick="imprimirPreparacao();" style="float:right;">
                            <i class="fa fa-print"></i> Imprimir
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- /.modal -->
    <!-- Vendor JS -->
    <script src="~/admin/js/vendors.min.js"></script>
    <script src="~/admin/assets/vendor_components/apexcharts-bundle/dist/apexcharts.min.js"></script>
    <script src="~/admin/assets/icons/feather-icons/feather.min.js"></script>


    <!-- DonManu Admin App -->
    <script src="~/admin/js/jquery.smartmenus.js"></script>
    <script src="~/admin/js/menus.js"></script>
    <script src="~/admin/js/template.js"></script>
    <script src="~/admin/js/graph.js"></script>
    <link rel="stylesheet" href="/admin/plugins/JqueryConfirm/jquery-confirm.css">
    <script src="~/admin/plugins/JqueryConfirm/jquery-confirm.js" type="text/javascript"></script>
    <script src="~/admin/js/script.js"></script>
    <script src="~/admin/js/toastr.js"></script>
    <script>
        window.toastr.options = {
            "closeButton": true,
            "debug": false,
            "newestOnTop": false,
            "progressBar": false,
            "positionClass": "toast-top-right",
            "preventDuplicates": false,
            "onclick": null,
            "showDuration": "300",
            "hideDuration": "1000",
            "timeOut": "5000",
            "extendedTimeOut": "1000",
            "showEasing": "swing",
            "hideEasing": "linear",
            "showMethod": "fadeIn",
            "hideMethod": "fadeOut"
        };

        function imprimirContaMesa() {
            var divToPrint = document.getElementById("divImpressao");
            newWin = window.open("");
            newWin.document.write(divToPrint.outerHTML);
            newWin.print();
            newWin.close();
        }
        function imprimirPreparacao() {
            var divToPrint = document.getElementById("modalImpressaoPreparacao");
            newWin = window.open("");
            newWin.document.write(divToPrint.outerHTML);
            newWin.print();
            newWin.close();
        }

        function calcularTaxaServico(totalitens, taxaServico) {
            var valortaxa = (taxaServico * totalitens) / 100;
            return valortaxa;
        }

        function calcularTotalPedidoComTaxaServico(totalitens, taxaServico) {
            return totalitens + calcularTaxaServico(totalitens, taxaServico);
        }

        function getPedidoImpressaoById(idpedido) {
            let pedido = [];
            $.each(LISTAMESAS, function (idx, mesa) {
                if (!isNullOrEmpty(mesa.IdPedido) && mesa.IdPedido == idpedido) {
                    pedido = mesa.Pedido;
                    return;
                }
            });

            return pedido;
        }

        function printOrderById(idpedido) {
            let model = getPedidoImpressaoById(idpedido);

            printOrder(model);
        }

        function printOrder(model) {

            $("#modalImpressao #numeropedidoimpressao").html(("00000" + (isNullOrEmpty(model.id) ? model.Id : model.id)).slice(-5));
            $("#modalImpressao #numeromesaimpressao").html(("00" + (isNullOrEmpty(model.idMesa) ? model.IdMesa : model.idMesa)).slice(-3));
            $("#modalImpressao #datapedidoimpressao").html((isNullOrEmpty(model.dataPedidoImpressao) ? model.DataPedidoImpressao : model.dataPedidoImpressao));
            $("#modalImpressao #horapedidoimpressao").html((isNullOrEmpty(model.horaPedidoImpressao) ? model.HoraPedidoImpressao : model.horaPedidoImpressao));

            $("#tableItensImpressao tbody").remove();
            var tbody = $('#tableItensImpressao').children('tbody');

            var table = tbody.length ? tbody : $('#tableItensImpressao');
            var totalitens = parseFloat(0);
            $.each((isNullOrEmpty(model.itensImpressao) ? model.ItensImpressao : model.itensImpressao), function (idx, item) {
                let qtde = (isNullOrEmpty(item.quantidade) ? item.Quantidade : item.quantidade);
                let valor = (isNullOrEmpty(item.valor) ? item.Valor : item.valor);
                table.append('<tr style="font-size: 11px;">' +
                    '<td style="text-align: center;">' + qtde + '</td> ' +
                    '<td style="max-width: 22ch; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">' + (isNullOrEmpty(item.descricao) ? item.Descricao : item.descricao) + '</td> ' +
                    '<td style="text-align: right;">' + (isNullOrEmpty(item.valorFormatado) ? item.ValorFormatado : item.valorFormatado) + '</td> ' +
                    '<td style="text-align: right;">' + formatMoney((qtde * valor), false) + '</td> ' +
                    '</tr>');
                totalitens += valor;
            });

            var valortaxa = 0;
            let taxa = (isNullOrEmpty(model.taxaServico) ? model.TaxaServico : model.taxaServico);
            $("#modalImpressao #subtotalimpressao").html(formatMoney(totalitens));
            if (isNullOrEmpty(taxa) || taxa == 0)
                $("#modalImpressao #taxaservicoimpressao").html("R$ 0,00");
            else {
                $("#modalImpressao #taxaservicoimpressao").html(formatMoney(calcularTaxaServico(totalitens, taxa)));
            }

            var total = valortaxa + totalitens;
            $("#modalImpressao #totalimpressao").html(formatMoney(total));


            jQuery('#modalImpressao').modal('show');
        }

        function printOrderPreparacaoById(idpedido) {
            let model = [];
            $.each(LISTAPEDIDOSIMPRESSAO, function (idx, mesa) {
                if (!isNullOrEmpty(mesa.IdPedido) && mesa.IdPedido == idpedido) {
                    model = mesa.Pedido;
                    return;
                }
            });

            printOrderPreparacao(model);
        }

        function printOrderPreparacao(model) {
            $("#modalImpressaoPreparacao #numeropedidoimpressao").html(("00000" + (isNullOrEmpty(model.id) ? model.Id : model.id)).slice(-5));
            $("#modalImpressaoPreparacao #numeromesaimpressao").html(("00" + (isNullOrEmpty(model.idMesa) ? model.IdMesa : model.idMesa)).slice(-3));
            $("#modalImpressaoPreparacao #datapedidoimpressao").html((isNullOrEmpty(model.dataPedidoImpressao) ? model.DataPedidoImpressao : model.dataPedidoImpressao));
            $("#modalImpressaoPreparacao #horapedidoimpressao").html((isNullOrEmpty(model.horaPedidoImpressao) ? model.HoraPedidoImpressao : model.horaPedidoImpressao));

            $("#tableItensImpressaoPreparacao tbody tr").remove();
            var tbody = $('#tableItensImpressaoPreparacao').children('tbody');
            var table = tbody.length ? tbody : $('#tableItensImpressaoPreparacao');

            $.each(model.Itens, function (idx, item) {
                let status = (isNullOrEmpty(item.idStatusPedidoItem) ? item.IdStatusPedidoItem : item.idStatusPedidoItem);
                if (status != 2) return;

                let observacao = item.Observacao;
                if (!isNullOrEmpty(observacao)) {
                    observacao = ' <div style="display: inline-flex; margin-left: 2px;"> ' +
                        '    <span class="mdi mdi-subdirectory-arrow-right"></span> <p> ' + observacao + '</p> ' +
                        ' </div>';
                }

                observacao = isNullOrEmpty(observacao) ? '' : observacao;

                let excecoes = '';
                $.each(item.Excecao, function (idx, excecao) {
                    excecoes += ' <div style="display: inline-flex; margin-left: 2px;"> ' +
                        '    <span class="mdi mdi-subdirectory-arrow-right"></span> <p><b>Sem</b> ' + excecao.Observacao + '</p> ' +
                        ' </div>';
                });

                excecoes = isNullOrEmpty(excecoes) ? '' : excecoes;

                let quebralinha = '';
                //if (isNullOrEmpty(excecoes) && isNullOrEmpty(observacao))
                quebralinha = '<br/>';

                table.append('<tr style="font-size: 10px;">' +
                    '<td> ' +
                    '<div style="max-width: 43ch; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">' +
                    item.Menu.Nome +
                    '</div>' +
                    observacao +
                    excecoes +
                    quebralinha +
                    '</td> ' +
                    '</tr>');

            });

            jQuery('#modalImpressaoPreparacao').modal('show');
        }

    </script>
    <script>'serviceWorker' in navigator && navigator.serviceWorker.register('/serviceworker')</script>
    @await RenderSectionAsync("Scripts", required: false)
</body>

</html>
